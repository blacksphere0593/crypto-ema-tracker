@tailwind base;
@tailwind components;
@tailwind utilities;

/* CSS Variables for safe areas */
:root {
  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);
}

/* Base styles */
html {
  height: 100%;
  overflow: hidden;
}

body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI',
    'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans',
    'Helvetica Neue', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* Prevent overscroll bounce on iOS */
  overscroll-behavior: none;
  /* Prevent text selection on long press in standalone mode */
  -webkit-user-select: none;
  user-select: none;
}

/* Allow text selection in inputs and textareas */
input, textarea {
  -webkit-user-select: text;
  user-select: text;
}

/* Standalone PWA mode adjustments */
@media all and (display-mode: standalone) {
  /* Add padding for notch/dynamic island */
  .pwa-header {
    padding-top: max(var(--sat), 12px);
  }

  /* Add padding for home indicator */
  .pwa-footer {
    padding-bottom: max(var(--sab), 12px);
  }

  /* Full height accounting for safe areas */
  .pwa-container {
    min-height: 100vh;
    min-height: 100dvh;
    padding-top: var(--sat);
    padding-bottom: var(--sab);
    padding-left: var(--sal);
    padding-right: var(--sar);
  }
}

/* Smooth scrolling for chat */
.chat-scroll {
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

/* Hide scrollbar but keep functionality */
.hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.hide-scrollbar::-webkit-scrollbar {
  display: none;
}

/* Touch-friendly tap targets */
@layer components {
  .touch-target {
    @apply min-h-[44px] min-w-[44px];
  }
}

/* iOS keyboard handling */
@supports (-webkit-touch-callout: none) {
  .keyboard-aware {
    /* Adjust for iOS keyboard */
    padding-bottom: env(keyboard-inset-height, 0px);
  }
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse-subtle {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.animate-fade-in {
  animation: fadeIn 0.2s ease-out forwards;
}

.animate-slide-up {
  animation: slideUp 0.3s ease-out forwards;
}

.animate-pulse-subtle {
  animation: pulse-subtle 2s ease-in-out infinite;
}

/* Focus styles for accessibility */
button:focus-visible,
input:focus-visible,
a:focus-visible {
  @apply outline-none ring-2 ring-emerald-500 ring-offset-2 ring-offset-neutral-950;
}

/* Haptic feedback simulation via CSS */
.haptic-press:active {
  transform: scale(0.98);
  transition: transform 0.1s ease;
}

/* Glass effect for overlays */
.glass {
  background: rgba(23, 23, 23, 0.8);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* Chip/tag styling */
.chip {
  @apply inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium;
  @apply bg-neutral-800 text-neutral-300 border border-neutral-700;
  @apply transition-colors duration-150;
}

.chip:hover {
  @apply bg-neutral-700 text-neutral-200;
}

.chip-active {
  @apply bg-emerald-500/20 text-emerald-400 border-emerald-500/30;
}

/* Loading spinner */
.spinner {
  @apply w-5 h-5 border-2 border-neutral-700 border-t-emerald-500 rounded-full;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Message bubbles */
.message-user {
  @apply bg-neutral-800 rounded-2xl rounded-tr-md;
}

.message-assistant {
  @apply bg-neutral-900 border border-neutral-800 rounded-2xl rounded-tl-md;
}

/* Ticker badges */
.ticker-badge {
  @apply inline-flex items-center gap-1 px-2.5 py-1.5 rounded-lg text-xs font-semibold;
  @apply bg-emerald-500/10 text-emerald-400 border border-emerald-500/20;
  @apply transition-all duration-150;
}

.ticker-badge:hover {
  @apply bg-emerald-500/20 border-emerald-500/30;
}

/* Desktop-specific styles */
@media (min-width: 768px) {
  body {
    /* Allow user select on desktop */
    -webkit-user-select: auto;
    user-select: auto;
  }

  /* Show scrollbars on desktop */
  .hide-scrollbar-mobile {
    -ms-overflow-style: auto;
    scrollbar-width: thin;
  }
  .hide-scrollbar-mobile::-webkit-scrollbar {
    display: block;
    width: 8px;
  }
  .hide-scrollbar-mobile::-webkit-scrollbar-track {
    background: transparent;
  }
  .hide-scrollbar-mobile::-webkit-scrollbar-thumb {
    background: rgba(115, 115, 115, 0.3);
    border-radius: 4px;
  }
  .hide-scrollbar-mobile::-webkit-scrollbar-thumb:hover {
    background: rgba(115, 115, 115, 0.5);
  }
}

/* Prevent double-tap zoom on buttons */
button {
  touch-action: manipulation;
}

/* Input styling for mobile */
input[type="text"],
input[type="search"] {
  /* Prevent iOS zoom on focus */
  font-size: 16px;
  touch-action: manipulation;
}

/* Fix for iOS input zoom */
@supports (-webkit-touch-callout: none) {
  input[type="text"],
  input[type="search"] {
    font-size: max(16px, 1rem);
  }
}
